import{o as W,n as z,u as P,E as k,r as i,j as t,c as m}from"./vendor-e59bfd4a.js";import{u as F,p as K,q as E,k as B,_ as M,E as n,F as x,H as _,B as w,y as H,r as U,f as u,U as $,x as q,w as p,I as V}from"./index-51b49a5b.js";const Q=W(()=>{var b;const{sessionsStore:T,logsStore:s,globalStore:r}=F(),j=z(),{t:l}=P(),{app:a}=k(),[S,c]=i.useState(!1),{tableRef:C,handleRowsRendered:I,isLoadingMore:N,currentPage:h}=K({pageSize:s.pageSize,overlapSize:s.overlapSize,getTotalPages:()=>{var e,o;return((o=(e=s.logsOverview)==null?void 0:e.meta)==null?void 0:o.totalPages)||0},loadData:async(e,o)=>{a&&await s.loadLogsOverviewOnDemand(a,!0,!1,e,o)},dependencies:[a]}),L=i.useCallback(e=>{a&&j(`/logs/session/${a}/${e.rowData.instanceId}/${encodeURIComponent(e.rowData.sessionPoolId)}`)},[a]);E(),i.useEffect(()=>{a&&(r.updateApp(a),T.setAppPath(a),s.loadLogsOverviewOnDemand(a,!0,!0))},[a]),B(l("routes.logs")+" - "+(a||""));const y=e=>{s.setSearchTerm(e.target.value),a&&v(a,!0)},f=(e,o,d,g)=>{r.isAutoRefreshActive&&r.stopAutoReload(),c(!0);const A=Date.now(),R=750;s.loadLogsOverviewOnDemand(e,!0,o,d,g).then(()=>{const D=Date.now()-A,O=Math.max(0,R-D);setTimeout(()=>{c(!1)},O)}).catch(()=>{c(!1)})},v=i.useCallback(M((e,o,d,g)=>f(e,o,d,g),600),[]);return t.jsxs("div",{className:n.root,children:[t.jsxs(x,{justifyContent:"space-between",alignItems:"center",children:[t.jsx(_,{variant:"h2",title:l("logs.chooseAppInst")}),t.jsxs(x,{spacing:2,alignItems:"center",children:[a&&t.jsx(w,{color:"neutral",icon:"refresh",bLoading:S,onClick:()=>f(a,!1,h,s.overlapSize)}),!s.filterToggle&&t.jsx(w,{color:"neutral",icon:"search",onClick:()=>s.setFilterToggle()}),s.filterToggle&&t.jsx(H,{value:s.searchTerm,onChange:y,onClose:()=>s.setFilterToggle()})]})]}),t.jsx("div",{className:n.scrollx,children:t.jsx(U,{ref:C,collection:s.appInstanceIds,totalCount:((b=s.logsOverview.meta)==null?void 0:b.totalItems)||0,minTableWidth:1200,bLoading:s.loading||N,rowHeight:60,threshold:500,onRowsRendered:I,className:n.vTable,sortDirection:s.orderDir,sortBy:s.orderBy,onSort:({key:e,direction:o})=>{s.setOrder(e,o),a&&v(a,!1,h,s.overlapSize)},columns:[{label:l("sessions.plural"),dataKey:"instanceId",minWidth:386,align:"start",bSort:!0,className:n.pointer,component:e=>t.jsx("div",{className:m(u.wCell,n.statusAlign),children:e})},{dataKey:"users",label:l("logs.user"),minWidth:100,align:"start",component:(e,o)=>t.jsx($,{session:o})},{dataKey:"status",label:l("general.status"),align:"start",minWidth:100,className:n.pointer,component:(e,o)=>t.jsx(q,{session:o,highlight:!1})},{dataKey:"startedAt",label:l("sessions.startTime"),minWidth:135,align:"start",className:n.pointer,component:e=>t.jsx("div",{className:m(u.wCell,n.statusAlign),children:p(Number(e))})},{dataKey:"endedAt",label:l("sessions.endTime"),minWidth:135,align:"start",className:n.pointer,component:e=>t.jsx("div",{className:m(u.wCell,n.statusAlign),children:p(Number(e))})},{label:l("overview.lastModified"),dataKey:"lastModified",minWidth:250,align:"start",bSort:!0,component:e=>t.jsxs("span",{className:n.fullWColl,children:[p(Number(e)),t.jsx(V,{name:"arrow_forward_ios"})]})}],onRowClick:L})})]})});export{Q as default};
