var xe=Object.defineProperty;var ge=(s,p,t)=>p in s?xe(s,p,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[p]=t;var v=(s,p,t)=>(ge(s,typeof p!="symbol"?p+"":p,t),t);import{j as e,c as b,o as I,n as Z,u as A,r as k,P as me,I as je,J as ee,K as we,x as V,a as M,S as E,h as ve,M as be,O as Se,s as se,v as te,w as oe,X as ne,Y as ie,y as F,i as fe,l as Ce}from"./vendor-e59bfd4a.js";import{T as ye,u as W,C as de,a as he,F as w,H as q,D,c as f,I as C,b as L,d as G,A as J,e as Q,S as _e,f as S,s as ae,N as $,L as ke,B as P,g as re,h as pe,i as H,j as Te,k as Ne,l as Le,m as le,G as Ae}from"./index-51b49a5b.js";import{P as ce}from"./PageHeader-7c95fa6a.js";import{c as g,G as z}from"./Overview.module-f8d3e44b.js";const Oe="_root_1whq5_1",Be="_darkerBlue_1whq5_12",Fe="_darkBlue_1whq5_16",Pe="_blue_1whq5_20",De="_lightBlue_1whq5_24",Ie="_success_1whq5_28",We="_warning_1whq5_32",Ke="_danger_1whq5_36",Re="_neutral_1whq5_40",He="_cursor_1whq5_59",U={root:Oe,darkerBlue:Be,darkBlue:Fe,blue:Pe,lightBlue:De,success:Ie,warning:We,danger:Ke,neutral:Re,cursor:He},O=({count:s,title:p,tooltip:t,color:n="neutral",className:o,onClick:r,enabled:d})=>{const u=()=>e.jsxs("div",{"data-test":"square-"+p,onClick:r,className:b(U.root,o,{[U.cursor]:r},{[U[n]]:d||typeof s=="number"&&s}),children:[e.jsx("h3",{children:s}),e.jsx("small",{children:p})]});return t?e.jsx(ye,{content:t,children:e.jsx("span",{children:e.jsx(u,{})})}):e.jsx(u,{})},ze=I(({server:s})=>{var y;const p=()=>{let m=0;if(s.apps)for(const K of s.apps)for(const R of K.status)R.status==="Running"&&m++;return m},t=()=>{var K,R;const m=p();return m===((K=s.apps)==null?void 0:K.length)?"success":m===0&&m!==((R=s.apps)==null?void 0:R.length)?"danger":"warning"},n=()=>{var m;return p()+" / "+((m=s.apps)==null?void 0:m.length)},o=()=>s.instancesConnected+" / "+s.idle+" / "+s.instances,r=()=>s.instancesConnected+" / "+s.instances,{logsStore:d,overviewStore:u}=W(),l=Z(),{t:h,i18n:x}=A(),[i,a]=k.useState(!1),[c,j]=k.useState(!1),T=k.useCallback(()=>{a(!i)},[i]),N=k.useCallback(()=>{j(!c)},[c]),B=m=>{d.setServerLogId(m),l("/logs/server")};return e.jsx(de,{className:g.serverCard,children:e.jsxs(he,{children:[e.jsxs(w,{justifyContent:"space-between",children:[e.jsx(q,{variant:"h2",classes:{heading:g.cardHeading},title:s.cluster?s.id:"Webswing Server"}),e.jsx(D,{position:"right",buttons:[{label:h("overview.verboseMode"),icon:"info",onClick:()=>u.toggleVerbose(s,"server"),dataTest:"verbose-mode-"+(s.cluster?s.id:"webswing-server")},{label:h("routes.logs"),icon:"list_alt",onClick:()=>B(s.id),dataTest:"logs-"+(s.cluster?s.id:"webswing-server")}],children:e.jsx("span",{"data-test":"serverOptions",className:b(f.wButtonDefault,f.medium,f.neutral,f.icon),children:e.jsx(C,{name:"more_vert"})})})]}),e.jsx("span",{className:g.neuralSub,children:s.websocketUrl}),e.jsx(w,{spacing:2,className:b(g.header,{[g.chipsLine]:u.isThereAnyServerVerbose}),children:s.verboseLogging&&e.jsxs(L,{size:"small",children:[e.jsx(C,{name:"check_circle_outline",size:"mini"})," ",h("overview.verboseMode")]})}),e.jsxs(w,{spacing:3,flexWrap:"wrap",children:[e.jsx(O,{title:h("sessions.sp_plural"),count:(y=s.sessionPools)==null?void 0:y.length,color:"darkerBlue"}),e.jsx(O,{title:h("overview.users"),count:s.users,color:"darkBlue",tooltip:c?"":h("overview.users.tooltip"),onClick:N}),s.cluster&&e.jsx(O,{title:h("overview.sessions"),count:r(),color:"blue",enabled:s.instances>0,tooltip:h("overview.sessionsCluster.tooltip")}),!s.cluster&&e.jsx(O,{title:h("overview.sessions"),count:o(),color:"blue",enabled:s.instances>0||s.idle>0,tooltip:h("overview.sessions.tooltip")}),e.jsx(O,{title:h("overview.connections"),count:s.connections,color:"lightBlue",tooltip:h("overview.connections.tooltip")}),e.jsx(O,{title:h("overview.appsRunning"),count:n(),color:t(),enabled:!0,onClick:T}),e.jsx(G,{bOpen:i,title:h("overview.availableApps"),onToggle:T,footer:!1,children:e.jsx("div",{className:g.spTable,children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("td",{children:h("routes.apps")}),e.jsx("td",{children:h("general.status")})]})}),e.jsx("tbody",{children:s.apps.map(m=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs(w,{spacing:2,children:[e.jsx(J,{shape:"square",src:Q+m.path+"/rest/appicon"}),e.jsxs("div",{children:[m.name,e.jsx("small",{children:m.path})]})]})}),e.jsx("td",{children:e.jsx(_e,{label:m.status[0].status})})]},m.name))})]})})}),e.jsx(G,{bOpen:c,title:h("overview.users"),onToggle:N,footer:!1,children:e.jsx("div",{className:g.userListTable,children:e.jsx("table",{children:e.jsxs("tbody",{children:[s.userList&&s.userList.map(m=>e.jsx("tr",{children:e.jsx("td",{children:m})},m)),!s.userList&&e.jsx("tr",{children:e.jsx("td",{children:h("overview.users.empty")})})]})})})})]})]})})}),qe=({className:s,width:p,height:t,onClick:n,apps:o})=>{const[r,d]=k.useState(!0),{t:u}=A(),l=()=>Object.entries(o).map(i=>({name:i[0],value:i[1]})),h=()=>{let i=0;return Object.entries(o).forEach(a=>{i+=a[1]}),i};k.useEffect(()=>{d(!h())},[o]);const x=["#0088FE","#00C49F","#FFBB28","#FF8042"];return e.jsx(e.Fragment,{children:e.jsxs(me,{onClick:n,className:s,width:p,height:t,children:[e.jsxs(je,{data:r?[{name:"no",value:1}]:l(),innerRadius:46,outerRadius:58,fill:"#8884d8",paddingAngle:0,dataKey:"value",className:g.pie,children:[e.jsx(ee,{value:h(),position:"center",className:g.cakeLabelTop,fontSize:"27px"}),e.jsx(ee,{value:u("overview.running"),position:"center",className:g.cakeLabelBottom}),l().map((i,a)=>e.jsx(we,{fill:r?"#E5E5E6":x[a%x.length]},`cell-${a}`))]}),!r&&e.jsx(V,{})]})})},X=I(({className:s,onClick:p,label:t,dialogHeader:n,children:o})=>{const[r,d]=k.useState(!1),u=k.useCallback(l=>{r!==l&&d(l||!r)},[r]);return e.jsxs(e.Fragment,{children:[e.jsx("span",{onClick:()=>d(!r),className:b(S.wCell,g.link),style:{justifyContent:"start"},children:t}),e.jsx(G,{bOpen:r,title:n,onToggle:u,footer:!1,children:o})]})}),ue=({sp:s,showPlaceholder:p=!1,className:t})=>{const n=s.warnings??[],{t:o}=A(),[r,d]=k.useState(!1);if(!n.length&&!p)return null;const u=()=>{d(!0)},l=x=>{d(x)},h=n.length?e.jsx(L,{size:"small",color:"warning",onClick:u,className:t,children:e.jsxs(w,{spacing:1,alignItems:"center",children:[e.jsx(C,{name:"warning",size:"mini"}),e.jsx("span",{children:o("overview.warningCount",{count:n.length})})]})}):e.jsx("span",{className:g.warningsPlaceholder,children:o("overview.noWarnings")});return e.jsxs(e.Fragment,{children:[h,n.length>0&&e.jsx(G,{bOpen:r,title:o("overview.warnings"),onToggle:l,footer:!1,children:e.jsx("ul",{className:g.warningsList,children:n.map((x,i)=>e.jsx("li",{children:x},`${s.id}-warning-${i}`))})})]})},Ge=({className:s,onClick:p,sp:t,clusterservers:n=[]})=>{const{logsStore:o,overviewStore:r,globalStore:d}=W(),u=Z(),{t:l}=A(),h=()=>Object.entries(t.apps).map(c=>{var T;const j=(T=d.paths)==null?void 0:T.find(N=>N.path===c[0]);return{name:j==null?void 0:j.name,path:c[0],value:c[1]}}),x=()=>{var j;return Object.entries(t.apps).length+" / "+((j=n[0].apps)==null?void 0:j.length)},i=k.useCallback(c=>{o.setSpLogId(c),u("/logs/sessionpool")},[history]),a=()=>t.drainMode?l("overview.resume"):l("overview.drainMode");return e.jsx(de,{onClick:p,className:b(g.spCard,s),children:e.jsxs(he,{children:[e.jsxs(w,{justifyContent:"space-between",children:[e.jsx(q,{variant:"h2",classes:{heading:g.cardHeading},title:t.id}),!t.stopped&&e.jsx(D,{position:"right",buttons:[{label:l("overview.verboseMode"),icon:"info",onClick:()=>r.toggleVerbose(t,"sp"),dataTest:"verbose-mode-"+t.id},{label:l("routes.logs"),icon:"list_alt",onClick:()=>i(t.id),dataTest:"logs-"+t.id},{label:a(),icon:"opacity",onClick:()=>r.toggleDrain(t),dataTest:"drain-mode-"+t.id},{label:l("overview.stop"),icon:"power_settings_new",onClick:()=>r.stop(t.id),shouldShow:!r.hasRunningInstances(t.apps),dataTest:"stop-"+t.id},{label:l("overview.shutdownSessions"),icon:"power_settings_new",onClick:()=>r.shutdown(t),shouldShow:r.hasRunningInstances(t.apps)}],children:e.jsx("span",{"data-test":"spOptions",className:b(f.wButtonDefault,f.medium,f.neutral,f.icon),children:e.jsx(C,{name:"more_vert"})})})]}),e.jsxs(w,{spacing:2,className:b(g.header,{[g.chipsLine]:r.isThereAnySPVerbose}),children:[t.stopped?e.jsx(L,{size:"small",color:"danger",children:l("overview.stopped")}):e.jsx(L,{size:"small",color:"success",children:l("overview.running")}),t.staticSP&&e.jsx(L,{size:"small",tooltip:l("overview.staticSP.tooltip"),children:l("overview.staticSP")}),!t.stopped&&t.drainMode&&e.jsxs(L,{size:"small",color:"warning",children:[e.jsx(C,{name:"opacity",size:"mini"})," ",t.drainAutoMode?l("overview.drainAutoMode"):l("overview.drainMode")]}),t.verboseLogging&&e.jsxs(L,{size:"small",children:[e.jsx(C,{name:"check_circle_outline",size:"mini"})," ",l("overview.verboseMode")]}),e.jsx(ue,{sp:t})]}),e.jsxs(w,{spacing:3,flexWrap:"wrap",children:[e.jsx(w,{flex:1,children:e.jsx(qe,{apps:t.apps,width:130,height:130,className:g.pie})}),e.jsx(w,{flex:2,children:e.jsx("table",{className:g.spTable,children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("strong",{children:[l("overview.maxSessions"),":"]})}),e.jsx("td",{children:t.maxInstances==-1?l("overview.unlimited"):t.maxInstances})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("strong",{children:[l("overview.maxIdleSessions"),":"]})}),e.jsx("td",{children:t.maxIdleInstances==-1?l("overview.unlimited"):t.maxIdleInstances})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("strong",{children:[l("overview.idleInstances"),":"]})}),e.jsx("td",{children:t.idle})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("strong",{children:[l("general.priority"),":"]})}),e.jsx("td",{children:t.priority})]}),e.jsxs("tr",{"data-test":"appsPerSP",children:[e.jsx("td",{children:e.jsxs("strong",{children:[l("routes.apps"),":"]})}),e.jsx("td",{"data-test":x(),children:e.jsx(X,{dialogHeader:l("overview.availableAppsforSP"),label:x(),children:e.jsx("div",{className:g.spTable,children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("td",{children:l("routes.apps")}),e.jsx("td",{children:l("overview.running")})]})}),e.jsx("tbody",{children:h().map((c,j)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs(w,{spacing:2,children:[e.jsx(J,{shape:"square",src:Q+c.path+"/rest/appicon"}),e.jsxs("div",{children:[c.name,e.jsx("small",{children:c.path})]})]})}),e.jsx("td",{children:c.value})]},c.name))})]})})})})]})]})})})]})]})})};class Y extends M.Component{constructor(t){super(t);v(this,"refList",M.createRef());v(this,"state");v(this,"onFilter",t=>()=>{const{onFilter:n}=this.props;n==null||n({key:t})});v(this,"onScroll",t=>{const{threshold:n,onReachEnd:o}=this.props;t.scrollTop>=t.scrollHeight-t.clientHeight-n?(o==null||o(),this.setState({scrolledtoBottom:!0})):this.setState({scrolledtoBottom:!1})});v(this,"scrollToggle",()=>{const{sortedList:t}=this.state;this.state.scrolledtoBottom?this.onScrollTo(0):this.onScrollTo(t.length)});v(this,"isScrollable",()=>{var n;if(!this.props.bscrollToBottom)return!1;const t=Number((n=this.refList.current)==null?void 0:n.props.height)/Number(this.props.rowHeight)-1;return this.state.sortedList.length>t});v(this,"rowGetter",({index:t})=>{var n;return((n=this.state.sortedList)==null?void 0:n[t])??void 0});v(this,"renderHeader",t=>()=>{const{header:n,headerHeight:o}=this.props;return n&&M.cloneElement(n,{style:{...n.props.style,height:o,width:t}})});v(this,"renderHeaderForColumn",t=>({dataKey:n})=>{const{headerHeight:o,rowHeight:r,columns:d,onFilter:u}=this.props,{sortDirection:l,sortBy:h}=this.state,x=d[t];return e.jsxs("div",{className:b(S.wHeaderCell),style:{height:o||r,justifyContent:x.align&&`flex-${x.align}`,minWidth:x.minWidth},children:[e.jsx("span",{children:x.label||""}),h===x.dataKey&&x.bSort?e.jsx(C,{name:l==="ASC"?"expand_less":"expand_more"}):x.bSort?e.jsx(C,{color:"neutral",name:"sort"}):null,u&&x.bFilter&&e.jsx(C,{name:"filter",onClick:this.onFilter(n)})]})});v(this,"renderCell",({cellData:t,columnIndex:n,rowData:o})=>{var u;const{columns:r}=this.props,d=r[n];return((u=d.component)==null?void 0:u.call(d,t,o))||e.jsx("div",{className:S.wCell,style:{justifyContent:d.align&&"flex-"+d.align},children:e.jsx("span",{children:t})})});v(this,"renderNoData",()=>e.jsx($,{...this.props.noData,message:this.props.bLoading?"Loading ...":void 0}));const n=t.sortBy||"",o=t.sortDirection||E.ASC;this.state={sortBy:n,sortDirection:o,sortedList:[],scrolledtoBottom:t.bscrollToBottom},this._sort=this._sort.bind(this)}componentDidMount(){var r;const{sortBy:t,sortDirection:n,sortedList:o}=this.state;this._sort({sortBy:t,sortDirection:n}),this.props.bscrollToBottom&&((r=this.refList.current)==null||r.scrollToRow(o.length))}UNSAFE_componentWillReceiveProps(t){const{sortBy:n,sortDirection:o}=this.state;if(t.collection){const r=ae(t.collection,[n]);o===E.DESC&&(r==null||r.reverse()),this.setState({sortedList:r})}}componentDidUpdate(t){var o,r;t.minTableWidth!==this.props.minTableWidth&&((o=this.refList.current)==null||o.forceUpdateGrid());const{sortedList:n}=this.state;this.props.bscrollToBottom&&n.length!==((r=t.collection)==null?void 0:r.length)&&setTimeout(()=>{var d;(d=this.refList.current)==null||d.scrollToRow(n.length-1)},10)}_sort({sortBy:t,sortDirection:n}){const o=this._sortList({sortBy:t,sortDirection:n});this.setState({sortBy:t,sortDirection:n,sortedList:o})}_sortList({sortBy:t,sortDirection:n}){const o=ae(this.props.collection,[t]);return n===E.DESC&&(o==null||o.reverse()),o}onScrollTo(t){var n;(n=this.refList.current)==null||n.scrollToRow(t)}render(){const{sortBy:t,sortDirection:n}=this.state,{bLoading:o,columns:r,className:d,collection:u,header:l,headerHeight:h,rowHeight:x,onRowClick:i,onRowDoubleClick:a,minTableWidth:c,rowClassName:j}=this.props;return e.jsxs("div",{className:b(S.wTable,d),children:[e.jsx(ke.Line,{className:S.loader,bLoading:o}),e.jsx(ve,{children:({height:T,width:N})=>{let B=N;return c&&(B=N<c?c:N),e.jsx(be,{ref:this.refList,headerHeight:h,headerRowRenderer:l&&this.renderHeader(B),height:T,noRowsRenderer:this.renderNoData,overscanRowCount:5,rowCount:(u==null?void 0:u.length)||0,rowGetter:this.rowGetter,rowHeight:x,sort:this._sort,sortBy:t,sortDirection:n,width:B,minWidth:0,rowClassName:`${j||""} ${i?S.pointer:""}`,onRowClick:i,onRowDoubleClick:a,onScroll:this.onScroll,children:r.map((y,m)=>e.jsx(Se,{cellRenderer:this.renderCell,dataKey:y.dataKey,disableSort:!y.bSort,className:b(S.column,y.className),flexGrow:y.flex||1,headerRenderer:this.renderHeaderForColumn(m),maxWidth:y.width,minWidth:y.minWidth,width:y.width||100},String(y.dataKey)+"_"+m))})}}),this.isScrollable()&&e.jsx(P,{className:S.fab,icon:this.state.scrolledtoBottom?"arrow_upward":"arrow_downward",onClick:()=>this.scrollToggle()})]})}}v(Y,"defaultProps",{headerHeight:50,rowHeight:60,threshold:0,bscrollToBottom:!1});const Me=I(()=>{var x;const{overviewStore:s,logsStore:p,globalStore:t}=W(),n=Z(),{t:o}=A(),r=i=>{let a=0;return Object.entries(i).forEach(c=>{a+=c[1]}),a},d=i=>{n(i)},u=i=>{p.setSpLogId(i),n("/logs/sessionpool")},l=i=>i.drainMode?o("overview.resume"):o("overview.drainMode"),h=s.searchTerm?(x=t.paths)==null?void 0:x.filter(i=>{var a,c;return((a=i.name)==null?void 0:a.toLowerCase().includes(s.searchTerm.toLocaleLowerCase()))||((c=i.path)==null?void 0:c.toLowerCase().includes(s.searchTerm.toLocaleLowerCase()))}):t.paths;return e.jsxs(e.Fragment,{children:[e.jsxs(w,{spacing:2,children:[e.jsx(re,{dataTest:"bySPs",icon:"filter_list",active:s.orderBy==="sp",onClick:()=>s.setOrderBy("sp"),children:o("overview.bySPs")}),e.jsx(re,{dataTest:"byApps",icon:"filter_list",active:s.orderBy==="app",onClick:()=>s.setOrderBy("app"),children:o("overview.byapps")})]}),e.jsxs("div",{className:b(pe.wTabContent),children:[s.orderBy==="sp"&&e.jsx("div",{className:g.table,children:e.jsx(Y,{columns:[{dataKey:"id",width:35,align:"start",label:"",className:H.actionCell,component:(i,a)=>e.jsx(D,{className:H.actionCellDropdown,buttons:[{label:o("overview.verboseMode"),icon:"info",onClick:()=>s.toggleVerbose(a,"sp"),shouldShow:!a.stopped},{label:o("routes.logs"),icon:"list_alt",onClick:()=>u(a.id)},{label:l(a),icon:"opacity",onClick:()=>s.toggleDrain(a),shouldShow:!a.stopped},{label:o("overview.stop"),icon:"power_settings_new",onClick:()=>s.stop(a.id),shouldShow:!s.hasRunningInstances(a.apps)&&!a.stopped},{label:o("overview.shutdownSessions"),icon:"power_settings_new",onClick:()=>s.shutdown(a),shouldShow:s.hasRunningInstances(a.apps)&&!a.stopped}],children:e.jsx(C,{name:"more_vert"})})},{label:o("general.name"),dataKey:"id",minWidth:200,align:"start",bSort:!0},{label:o("overview.appsRunning"),dataKey:"apps",minWidth:100,align:"start",component:(i,a)=>e.jsx("span",{className:S.wCell,style:{justifyContent:"start"},children:i?r(i):null})},{label:o("overview.maxSessions"),dataKey:"maxInstances",minWidth:100,align:"start",component:(i,a)=>e.jsx("span",{className:S.wCell,style:{justifyContent:"start"},children:i==-1?"Unlimited":i})},{label:o("overview.maxIdleSessions"),dataKey:"maxIdleInstances",minWidth:100,align:"start",component:(i,a)=>e.jsx("span",{className:S.wCell,style:{justifyContent:"start"},children:i==-1?"Unlimited":i})},{label:o("overview.idleInstances"),dataKey:"idle",minWidth:100,align:"start",component:(i,a)=>e.jsx("span",{className:S.wCell,style:{justifyContent:"start"},children:i==-1?"Unlimited":i})},{label:o("general.priority"),dataKey:"priority",minWidth:100,align:"start",bSort:!0},{label:o("general.status"),dataKey:"stopped",minWidth:100,align:"start",component:(i,a)=>i?e.jsx(L,{size:"small",color:"danger",children:o("overview.stopped")}):e.jsx(L,{size:"small",color:"success",children:o("overview.running")})},{label:o("overview.warnings"),dataKey:"warnings",minWidth:160,align:"start",component:(i,a)=>e.jsx(ue,{sp:a,showPlaceholder:!0})},{label:o("routes.apps"),dataKey:"apps",minWidth:100,align:"start",component:(i,a)=>e.jsx(X,{dialogHeader:o("overview.availableApps"),label:Object.entries(i).length+" / "+s.servers[0].apps.length,children:e.jsxs("table",{className:g.spTable,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:o("sessions.app")}),e.jsx("th",{children:o("status.running")})]})}),e.jsx("tbody",{children:i?Object.entries(i).map(c=>{var T;const j=(T=t.paths)==null?void 0:T.find(N=>N.path===c[0]);return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs(w,{spacing:2,children:[e.jsx(J,{shape:"square",src:Q+c[0]+"/rest/appicon"}),e.jsxs("div",{children:[j==null?void 0:j.name,e.jsx("small",{children:c[0]})]})]})}),e.jsx("td",{children:c[1]})]},c[0])}):null})]})})}],minTableWidth:650,rowHeight:60,threshold:500,rowClassName:g.ac,collection:s.filteredSPs})}),s.orderBy==="app"&&e.jsx("div",{className:g.table,children:e.jsx(Y,{columns:[{dataKey:"name",width:35,align:"start",label:"",className:H.actionCell,component:(i,a)=>e.jsx(D,{className:H.actionCellDropdown,buttons:[{label:o("general.config"),icon:"list_alt",onClick:()=>d("apps"+a.path)},{label:o("routes.sessions"),icon:"groups",onClick:()=>d("sessions"+a.path)}],children:e.jsx(C,{name:"more_vert"})})},{label:o("overview.appName"),dataKey:"name",minWidth:100,align:"start",bSort:!0},{label:o("overview.path"),dataKey:"path",minWidth:100,align:"start",bSort:!0},{label:o("overview.running"),dataKey:"runningInstances",minWidth:100,align:"start",bSort:!0},{label:o("sessions.sp_plural"),dataKey:"path",minWidth:100,align:"start",component:(i,a)=>{var c;return e.jsx(X,{dialogHeader:o("overview.sPsForApp"),label:s.appOnSP(a.path)+" / "+s.sessionPools.length,children:e.jsxs("table",{className:g.spTable,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("td",{children:o("sessions.sp")}),e.jsx("td",{children:o("status.running")})]})}),e.jsx("tbody",{children:i?(c=s.sessionPools)==null?void 0:c.map(j=>e.jsxs("tr",{children:[e.jsx("td",{children:j.id}),e.jsx("td",{children:j.apps[a.path]})]},j.id)):null})]})})}},{label:o("general.status"),dataKey:"status",minWidth:100,align:"start",component:(i,a)=>e.jsx(Te,{status:i})}],minTableWidth:435,rowHeight:60,threshold:500,rowClassName:g.ac,collection:h})})]})]})}),Ee="_root_lp6ou_1",Ue="_lineChart_lp6ou_1",Ve="_axisFont_lp6ou_6",$e="_chart_lp6ou_9",Xe="_tooltipWrapper_lp6ou_12",_={root:Ee,lineChart:Ue,axisFont:Ve,chart:$e,tooltipWrapper:Xe},Ye=I(()=>{const{scalingStore:s}=W(),{t:p}=A(),t={fontSize:"12px",lineHeight:"normal"},n={hour12:!0,hour:"numeric",minute:"2-digit"},o=d=>d.toLocaleString("en-US",n),r=d=>`${fe.t("sessions.time")}: ${d.toLocaleString("en-US")}`;return e.jsx("div",{className:_.root,children:e.jsxs(w,{itemsPerRow:2,children:[e.jsxs(w,{bColumn:!0,className:_.lineChart,children:[e.jsx(q,{className:_.charsHeading,variant:"h3",title:p("scaling.utilization")}),e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(te,{syncId:"scaling-chart",className:_.chart,data:s.getUtilizationStats.dataset,margin:{top:5,right:30,left:20,bottom:5},children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"colorTakenSlots",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#F5444A",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#F5444A",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"colorFreeSlots",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#82ca9d",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#82ca9d",stopOpacity:0})]})]}),e.jsx(oe,{strokeDasharray:"3 3",vertical:!1}),e.jsx(ne,{className:_.axisFont,dataKey:"x",tickFormatter:o,minTickGap:30}),e.jsx(ie,{className:_.axisFont,tickFormatter:s.getUtilizationStats.tickFormat}),e.jsx(V,{wrapperStyle:t,labelFormatter:r,formatter:s.getUtilizationStats.tooltipFormatter}),e.jsx(F,{type:"monotone",dataKey:"takenSlots",stackId:"1",stroke:"#F5444A",fillOpacity:1,fill:"url(#colorTakenSlots)"}),e.jsx(F,{type:"monotone",dataKey:"freeSlots",stackId:"1",stroke:"#82ca9d",fillOpacity:1,fill:"url(#colorFreeSlots)"})]})})]}),e.jsxs(w,{bColumn:!0,className:_.lineChart,children:[e.jsx(q,{className:_.charsHeading,variant:"h3",title:p("scaling.status")}),e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(te,{syncId:"scaling-chart",className:_.chart,data:s.getStatusStats.dataset,margin:{top:5,right:30,left:20,bottom:5},children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"colorActiveSP",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#82ca9d",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#82ca9d",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"colorAutodrainedSP",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#ffc658",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#ffc658",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"colorDrainedSP",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#F5444A",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#F5444A",stopOpacity:0})]})]}),e.jsx(oe,{strokeDasharray:"3 3",vertical:!1}),e.jsx(ne,{className:_.axisFont,dataKey:"x",tickFormatter:o,minTickGap:30}),e.jsx(ie,{className:_.axisFont,tickFormatter:s.getStatusStats.tickFormat}),e.jsx(V,{wrapperStyle:t,labelFormatter:r,formatter:s.getStatusStats.tooltipFormatter}),e.jsx(F,{type:"monotone",dataKey:"drainedSP",stackId:"1",stroke:"#F5444A",fillOpacity:1,fill:"url(#colorDrainedSP)"}),e.jsx(F,{type:"monotone",dataKey:"autodrainedSP",stackId:"1",stroke:"#ffc658",fillOpacity:1,fill:"url(#colorAutodrainedSP)"}),e.jsx(F,{type:"monotone",dataKey:"activeSP",stackId:"1",stroke:"#82ca9d",fillOpacity:1,fill:"url(#colorActiveSP)"})]})})]})]})})}),ts=I(()=>{var l,h,x,i;Ne("Overview");const{overviewStore:s,globalStore:p,scalingStore:t}=W(),{pathname:n}=Ce(),{t:o}=A(),r=n.includes("servers"),d=n.includes("sessionpools");k.useEffect(()=>{s.loadOverview(),p.loadPaths(),t.loadStats()},[]),Le(()=>{s.loadOverview(),t.loadStats()},5e3);const u=()=>{s.loadOverview(),t.loadStats()};return e.jsxs("div",{children:[s.isCluster&&t.isScalingEnabled()&&e.jsxs(e.Fragment,{children:[e.jsx(le,{value:t.statType==Ae.Extended,size:"medium",position:"right",onClick:()=>t.toggleStatType(),children:o("scaling.statType.extended")}),e.jsx(Ye,{})]}),!d&&e.jsxs(e.Fragment,{children:[e.jsxs(w,{justifyContent:"space-between",alignItems:"center",children:[e.jsx(ce,{title:s.isCluster?o("overview.clusters"):o("overview.server")}),e.jsx(P,{dataTest:"refreshButton",color:"neutral",icon:"refresh",bLoading:s.isLoading,onClick:()=>{u()}})]}),e.jsx(z,{container:!0,spacing:"sm",children:(l=s.filteredServers)!=null&&l.length?(h=s.filteredServers)==null?void 0:h.map(a=>e.jsx(z,{item:!0,xs:12,md:6,children:e.jsx(ze,{server:a})},a.id)):e.jsx($,{message:o("overview.noServers")})})]}),!r&&s.isCluster&&e.jsxs(e.Fragment,{children:[e.jsxs(w,{justifyContent:"space-between",alignItems:"center",children:[e.jsx(ce,{title:o("sessions.sp_plural")}),e.jsxs(w,{spacing:2,children:[s.anyStoppedSP&&e.jsx(le,{value:s.showStopped,size:"medium",position:"right",onClick:()=>s.toggleShowStopped(),children:o("overview.showStopped")}),d&&e.jsx(P,{dataTest:"refreshButton",color:"neutral",icon:"refresh",bLoading:s.isLoading,onClick:()=>{u()}}),e.jsx(P,{dataTest:"overviewApps",icon:"apps",color:s.spView==="grid"?"blue":"neutral",onClick:()=>s.setSpView("grid")}),e.jsx(P,{dataTest:"overviewList",icon:"list",color:s.spView==="table"?"blue":"neutral",onClick:()=>s.setSpView("table")}),s.sessionPools.length>0&&e.jsx(D,{position:"right",buttons:[{label:o("overview.drainAll"),icon:"opacity",onClick:()=>s.drainAllSessionPools()},{label:o("overview.resumePools"),icon:"restore",onClick:()=>s.resumeAllSessionPools()},s.hasRunningSessions?{label:o("overview.shutdownAllSessions"),icon:"power_settings_new",onClick:()=>s.shutdownAllSessions(),buttons:[{label:o("overview.forceKillAllSessions"),onClick:()=>s.forceKillAllSessions()}]}:{label:o("overview.stopAllPools"),icon:"power_settings_new",onClick:()=>s.stopAllSessionPools()}],children:e.jsx("span",{"data-test":"spsOptions",className:b(f.wButtonDefault,f.medium,f.neutral,f.icon),children:e.jsx(C,{name:"more_vert"})})})]})]}),e.jsxs("div",{className:b(pe.wTabContent),children:[s.spView==="grid"&&e.jsx(z,{container:!0,spacing:"sm",children:(x=s.filteredSPs)!=null&&x.length?(i=s.filteredSPs)==null?void 0:i.map((a,c)=>e.jsx(z,{item:!0,xs:12,md:6,dataTest:"SPcard-"+c,children:e.jsx(Ge,{clusterservers:s.servers,sp:a})},a.id)):e.jsx($,{message:o("overview.noSps")})}),s.spView==="table"&&e.jsx(Me,{})]})]})]})});export{ts as default};
